# 网络加密磁盘系统 - 启动说明

## 环境要求

### 后端
- Python 3.8+
- pip

### 前端
- Node.js 16+
- npm 或 yarn

## 安装步骤

### 1. 安装后端依赖

```bash
cd backend
pip install -r ../requirements.txt
```

### 2. 安装前端依赖

```bash
cd frontend
npm install
```

## 启动系统

### 1. 启动后端服务器

```bash
cd backend
python app.py
```

后端服务器将在 `http://localhost:5000` 启动

### 2. 启动前端开发服务器

在新的终端窗口中：

```bash
cd frontend
npm start
```

前端应用将在 `http://localhost:3000` 启动，浏览器会自动打开

## QQ邮箱配置（可选）

如果需要使用QQ邮箱发送验证码邮件，需要配置SMTP：

1. **获取QQ邮箱授权码**
   - 登录QQ邮箱 → 设置 → 账户 → POP3/IMAP/SMTP服务 → 生成授权码
   - 详细步骤请查看 `QQ邮箱配置说明.md`

2. **创建配置文件**
   ```bash
   cd backend
   copy .env.example .env
   ```
   然后编辑 `.env` 文件，填写你的QQ邮箱信息

3. **如果不配置邮箱**
   - 验证码会打印在后端控制台
   - 可以直接查看控制台获取验证码进行测试

## 使用说明

### 注册新用户

1. 打开登录页面
2. 点击"注册"标签
3. 填写用户名、邮箱和密码
4. 点击"注册"按钮
5. **重要**：保存显示的恢复码，用于密钥找回

### 登录

支持两种登录方式：

1. **密码登录**：使用用户名和密码
2. **邮箱验证码登录**：
   - 输入邮箱地址
   - 点击"发送验证码"
   - **如果配置了QQ邮箱**：验证码会发送到你的邮箱
   - **如果未配置邮箱**：验证码会打印在后端控制台
   - 输入验证码登录

### 文件管理

1. **上传文件**：点击"上传文件"按钮，选择文件
2. **下载文件**：点击文件列表中的"下载"按钮
3. **删除文件**：点击文件列表中的"删除"按钮

### 用户组管理

1. **创建用户组**：在侧边栏点击"创建用户组"
2. **切换用户组**：点击侧边栏中的用户组名称
3. **查看组内文件**：选择用户组后，文件列表会显示该组的文件

## 安全特性

1. **加密存储**：所有文件使用AES-256-GCM加密存储
2. **加密传输**：使用RSA加密进行密钥交换
3. **一次一密**：每次登录生成新的会话密钥
4. **密钥找回**：通过邮箱验证码找回密钥

## 注意事项

1. **恢复码**：注册时显示的恢复码非常重要，请妥善保管
2. **密钥安全**：主密钥仅存储在客户端，服务器无法解密文件
3. **会话管理**：会话token存储在localStorage中，登出时会清除

## 故障排除

### 后端启动失败
- 检查Python版本是否为3.8+
- 检查是否安装了所有依赖：`pip install -r requirements.txt`
- 检查端口5000是否被占用

### 前端启动失败
- 检查Node.js版本是否为16+
- 删除node_modules文件夹，重新运行 `npm install`
- 检查端口3000是否被占用

### 无法连接后端
- 确认后端服务器已启动
- 检查前端代码中的API_BASE_URL配置
- 检查浏览器控制台的错误信息

## 开发说明

### 后端API文档

- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/email-code` - 发送邮箱验证码
- `POST /api/auth/recover-key` - 密钥找回
- `GET /api/files/list` - 获取文件列表
- `POST /api/files/upload` - 上传文件
- `GET /api/files/download/<file_id>` - 下载文件
- `DELETE /api/files/<file_id>` - 删除文件
- `GET /api/groups/list` - 获取用户组列表
- `POST /api/groups/create` - 创建用户组
- `POST /api/groups/join` - 加入用户组

### 数据库

数据库文件：`backend/encrypted_disk.db`（SQLite）

主要表：
- `users` - 用户信息
- `files` - 文件元数据
- `user_groups` - 用户组
- `group_members` - 组成员关系
- `sessions` - 会话信息
- `email_codes` - 邮箱验证码
